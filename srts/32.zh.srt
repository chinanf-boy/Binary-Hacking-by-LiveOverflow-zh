1
00:00:00,110 --> 00:00:03,480
So I was browsing reddit, and this new CTF for beginners popped up.

2
00:00:03,479 --> 00:00:09,079
显然，我必须检查它，然后直接进入我最喜欢的类别，二进制开发

3
00:00:09,080 --> 00:00:10,080
stuff.

4
00:00:10,080 --> 00:00:14,080
当然，有一个服务器可以作为普通用户连接，当您利用

5
00:00:14,079 --> 00:00:18,129
您将向另一个用户提升权限以访问机密的挑战

6
00:00:18,130 --> 00:00:19,240
flag.

7
00:00:19,240 --> 00:00:23,810
但最大的挑战是，我找不到禁止这样做的规则

8
00:00:23,810 --> 00:00:24,810
to gain root.

9
00:00:24,810 --> 00:00:32,480
So let’s do that.

10
00:00:32,480 --> 00:00:34,990
还记得我的脏母牛解释视频吗？

11
00:00:34,990 --> 00:00:40,030
让我们使用我们在那里的概念验证工具，并测试它是否适用于此

12
00:00:40,030 --> 00:00:41,030
server.

13
00:00:41,030 --> 00:00:44,370
So we can simply copy this code to a file in tmp and compile it.

14
00:00:44,370 --> 00:00:49,180
测试是否可以覆盖不属于我们的文件，而不覆盖关键文件

15
00:00:49,180 --> 00:00:55,050
根拥有的文件，我们作为系统上的另一个挑战用户登录，创建一个包含

16
00:00:55,050 --> 00:00:56,050
content.

17
00:00:56,050 --> 00:01:00,850
然后我们返回到第一个用户，对该文件执行dirty cow并尝试写入

18
00:01:00,850 --> 00:01:02,790
some other characters to it.

19
00:01:02,790 --> 00:01:04,950
And when we check, we can see that it works.

20
00:01:04,949 --> 00:01:09,849
此时，我在Reddit上给作者写了一条消息，通知他服务器是

21
00:01:09,850 --> 00:01:12,070
vulnerable and he should quickly update.

22
00:01:12,070 --> 00:01:16,550
But now we need a plan what root file we could overwrite to become root ourselves.

23
00:01:16,550 --> 00:01:21,650
我们的限制是，我们必须覆盖文件中的某些内容，我们不能追加或

24
00:01:21,650 --> 00:01:23,500
prepend anything.

25
00:01:23,500 --> 00:01:29,520
第一个明显的想法是使用setuid二进制文件，但问题是为了编写一个

26
00:01:29,520 --> 00:01:34,190
从后门shell到二进制文件，我们必须解析elf文件格式并找出

27
00:01:34,189 --> 00:01:36,549
where the entry point is.

28
00:01:36,549 --> 00:01:40,589
An easier strategy is to overwrite data in a text file.

29
00:01:40,590 --> 00:01:43,280
And I chose /etc/passwd.

30
00:01:43,280 --> 00:01:48,200
您可以在这里看到用户的用户ID，如果我们要更改pwn1的uid

31
00:01:48,200 --> 00:01:51,280
user to 0, we would login as root.

32
00:01:51,280 --> 00:01:52,280
So.

33
00:01:52,280 --> 00:01:55,560
The dirty cow proof of concept writes to the beginning of the file.

34
00:01:55,560 --> 00:01:58,560
So first we have to figure out the offset inside of /etc/passwd.

35
00:01:58,560 --> 00:02:02,160
We can use hexdump for that and count a little bit.

36
00:02:02,159 --> 00:02:06,839
So pwn1 user is at offset hex 4c0 plus a little bit.

37
00:02:06,840 --> 00:02:12,970
I use python as a caluclator and modify the exploit code to write to a fixed offset.

38
00:02:12,970 --> 00:02:14,960
I think here would be a good plan.

39
00:02:14,959 --> 00:02:20,089
你必须非常小心地选择这些补偿和选择什么

40
00:02:20,091 --> 00:02:23,951
write, because you can screw up the whole system if you don’t.

41
00:02:23,950 --> 00:02:30,150
So I copy /etc/passwd to try what I want to do before doing it to the real binary.

42
00:02:30,150 --> 00:02:33,730
And of course, my first attempt would have wrecked the system.

43
00:02:33,730 --> 00:02:40,670
因此，稍微调整偏移量，并在末尾附加新行，最终是成功的。

44
00:02:40,670 --> 00:02:43,360
and I write to the real /etc/passwd.

45
00:02:43,360 --> 00:02:47,870
Now when we switch to pwn1 or ssh login to pwn1, we get a root shell.

46
00:02:47,870 --> 00:02:51,770
Then we can read out all flags.

47
00:02:51,770 --> 00:02:57,290
Once we are done, we revert back /etc/passwd to the original state.

48
00:02:57,290 --> 00:02:58,550
Some important notes.

49
00:02:58,550 --> 00:03:01,930
Be very very careful what you overwrite with an exploit like this.

50
00:03:01,930 --> 00:03:08,730
只有一个字节计算错误，您可能会使系统不稳定、崩溃、DOS或

51
00:03:08,730 --> 00:03:10,400
lock yourself out.

52
00:03:10,400 --> 00:03:15,590
Also if you find a server vulnerable, think about the impact or context you are in.

53
00:03:15,590 --> 00:03:21,070
这个小的私有CTF服务器项目，打算被锤击，不同于

54
00:03:21,069 --> 00:03:23,789
a webserver you exploited from some random company.

55
00:03:23,790 --> 00:03:27,950
因此，如果您没有权限或可能导致

56
00:03:27,950 --> 00:03:30,400
damage.

57
00:03:30,400 --> 00:03:32,210
Make an ethical decision.

58
00:03:32,209 --> 00:03:34,519
Be aware of the risk you are taking.

59
00:03:34,519 --> 00:03:39,239
And thanks to maro for being cool about this and allowing me to make a video about it.

60
00:03:39,239 --> 00:03:40,299
Good luck with your plattform.

